version: "3.7"
services:
  frontend:
    build:
      context: https://github.com/uwcirg/AHRQ-CDS-Connect-PAIN-MANAGEMENT-SUMMARY.git
      dockerfile: ${FRONTEND_DOCKERFILE:-Dockerfile}
    ports:
      # allow override of target and published port
      - ${P_PORT:-8000}:${T_PORT:-8000}
    volumes:
      - ./:/opt/app
    env_file:
      # Reuse .env from CRA
      - .env

  sof_wrapper:
    build:
      context: https://github.com/uwcirg/sof-api-wrapper.git
    volumes:
      - ./:/opt/app
      # mount host certificate bundle into container
      - /etc/ssl/certs/ca-certificates.crt:/etc/ssl/certs/ca-certificates.crt:ro
      # mount host hosts file into container
      - /etc/hosts:/etc/hosts:ro
    ports:
      # allow override of published port
      - ${P_PORT:-5000}:5000
    environment:
      REQUESTS_CA_BUNDLE: /etc/ssl/certs/ca-certificates.crt
    env_file:
      - sof_wrapper.env

volumes:
  db-data:
  certificate-data:
